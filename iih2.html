<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Mastermind V3</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; background-color: #1e1e2e; color: #cdd6f4; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .container { background: #313244; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); max-width: 800px; width: 100%; text-align: center; position: relative; }
        h1 { margin-bottom: 0.5rem; color: #89b4fa; margin-top: 0; }
        
        /* Top Controls */
        .controls-bar { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 15px; background: #181825; padding: 10px; border-radius: 8px; box-sizing: border-box; }
        .mode-toggle { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: #a6adc8; cursor: pointer; }
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #45475a; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #89b4fa; }
        input:checked + .slider:before { transform: translateX(20px); }

        /* Nav Bar */
        .nav-bar { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 20px; }
        .nav-btn { flex: 1 1 auto; padding: 8px 12px; border: none; background: #45475a; color: #a6adc8; cursor: pointer; border-radius: 6px; font-weight: bold; font-size: 0.85rem; transition: all 0.2s; min-width: 100px; }
        .nav-btn:hover { background: #585b70; color: white; }
        .nav-btn.active { background: #89b4fa; color: #1e1e2e; }
        .nav-btn.flagged-deck { background: #f38ba8; color: #1e1e2e; }
        
        .stat-box { display: flex; justify-content: space-between; margin-bottom: 1.5rem; font-size: 0.9rem; color: #a6adc8; border-top: 1px solid #45475a; padding-top: 10px; }
        
        /* Question Area */
        .question-box { margin-bottom: 2rem; background: #181825; padding: 20px; border-radius: 8px; border: 1px solid #45475a; position: relative; }
        .flag-btn { position: absolute; top: 10px; right: 10px; background: transparent; border: 1px solid #45475a; color: #a6adc8; cursor: pointer; padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; transition: all 0.2s; }
        .flag-btn.active { background: #f38ba8; color: #1e1e2e; border-color: #f38ba8; }
        .flag-btn:hover { border-color: #f38ba8; color: #f38ba8; }
        .flag-btn.active:hover { color: #1e1e2e; }

        .category-tag { background: #fab387; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: #1e1e2e; font-weight: bold; display: block; margin-bottom: 10px; width: fit-content; margin-left: auto; margin-right: auto;}
        .clue-label { color: #f9e2af; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; display: block; }
        .main-q { font-size: 1.1rem; line-height: 1.6; color: #cdd6f4; white-space: pre-wrap; }
        
        /* Options */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }
        
        .opt-btn { background: #45475a; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1rem; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; min-height: 60px; }
        .opt-btn:hover { background: #585b70; transform: translateY(-2px); }
        .opt-btn:active { transform: translateY(0); }
        .opt-btn.correct { background: #a6e3a1; color: #1e1e2e; font-weight: bold; }
        .opt-btn.wrong { background: #f38ba8; color: #1e1e2e; opacity: 0.7; }

        /* Flashcard Mode Specifics */
        .reveal-btn { width: 100%; background: #f9e2af; color: #1e1e2e; font-weight: bold; padding: 20px; border: none; border-radius: 8px; font-size: 1.2rem; cursor: pointer; margin-bottom: 20px; }
        .flashcard-answer { background: #a6e3a1; color: #1e1e2e; padding: 20px; border-radius: 8px; margin-bottom: 15px; font-weight: bold; font-size: 1.2rem; display: none; }
        
        .hidden { display: none; }
        .next-btn { margin-top: 20px; background: #89b4fa; color: #1e1e2e; width: 100%; font-weight: bold; padding: 15px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>Medical Mastermind</h1>
    
    <div class="controls-bar">
        <label class="mode-toggle">
            <span>Quiz Mode</span>
            <div class="switch">
                <input type="checkbox" id="mode-switch" onchange="toggleMode()">
                <span class="slider"></span>
            </div>
            <span>Flashcard Mode</span>
        </label>
    </div>

    <div id="nav-container" class="nav-bar">
        </div>

    <div class="stat-box">
        <span id="deck-title">Deck: Microbes</span>
        <span id="streak">Streak: 0</span>
    </div>

    <div class="question-box">
        <button id="flag-btn" class="flag-btn" onclick="toggleFlag()">⚑ Flag</button>
        <span id="category" class="category-tag">Category</span>
        <span id="clue-label" class="clue-label">Clue Type</span>
        <div id="question-text" class="main-q">Loading...</div>
    </div>

    <div id="quiz-interface">
        <div id="options" class="options-grid">
            </div>
    </div>

    <div id="flashcard-interface" class="hidden">
        <button id="reveal-btn" class="reveal-btn" onclick="revealFlashcard()">Reveal Answer</button>
        <div id="flashcard-answer" class="flashcard-answer">Answer Here</div>
        <div id="flashcard-controls" class="options-grid hidden">
            <button class="opt-btn wrong" onclick="markFlashcard(false)">Forgot it</button>
            <button class="opt-btn correct" onclick="markFlashcard(true)">Got it</button>
        </div>
    </div>

    <button id="next-btn" class="next-btn hidden" onclick="generateQuestion()">Next Question</button>
</div>

<script>
    // --- THE MASTER DATABASE (Filtered) ---
    const db = {"Microbes": [{"name": "Staphylococcus aureus", "category": "Bacteria", "attributes": {"Characteristics": "Gram positive cocci", "Natural reservoir": "Transient normal flora on skin, vagina, other mucosal surfaces\n\nNasopharynx often colonized", "Transmission": "direct contact or respiratory droplets", "Diseases": "Skin infections: cellulitis, impetigo, folliculitis, carbuncles, scaled skin syndrome\n\nosteomyelitis, septic arthritis, endocarditis, pnemonia, gatroenteritis\n\ntoxic shock, bactermeia", "Risk factors": "implanted devices, IV drug use, intubation", "Pathogenesis factors": "adhesion proteins, MSCRAMMs, toxins", "Identification": "gram stain and culture\n\ncatalase+, coagulase+, beta hemolytic, yallow colonies on mannitol-salt agar", "Treatment": "I&D absesses\n\nMRSA: Vancomycin\n\nMSSA: nafcillin", "Prevention": "Good hygiene"}}, {"name": "Staphylococcus epidermidis", "category": "Bacteria", "attributes": {"Characteristics": "Gram positive cocci", "Natural reservoir": "Normal skin flora, mucosal surfaces, conjuctiva, ears, vagina", "Transmission": "normal flora by direct contact", "Diseases": "infections due to implanted devices", "Risk factors": "implanted devices", "Pathogenesis factors": "biofilms", "Identification": "gram stain and culture", "Treatment": "Vancomycin with rifampin or gentamicin", "Prevention": "Good hygiene"}}, {"name": "Strepococcus pyogenes (GAS)", "category": "Bacteria", "attributes": {"Characteristics": "Gram positive cocci", "Transmission": "respiratory droplets or direct contact", "Diseases": "cellulitis, impetigo, erysipelas\n\nscarlet fever, pueperal sepsis, bacteremia, pneumonia, necrotizing fasciitis, TSS, pharyngitis", "Identification": "gram stain and culture\n\ncatalase negative, beta hemolytic, bacitracin sensitive", "Treatment": "Penicillin"}}, {"name": "Streptococcus Agalactiae (GBS)", "category": "Bacteria", "attributes": {"Characteristics": "Gram positive cocci", "Transmission": "mother to newborn during pregnancy, delivery, or later", "Diseases": "meningitis, sepsis in neonates, skin infections esp. in diabetic foot ulcers", "Treatment": "penicillin, ampicillin with gentamycin for severe cases", "Prevention": "screening of pregnant women"}}, {"name": "Clostridium tetani", "category": "Bacteria", "attributes": {"Transmission": "innoculation via trauma with contaminated soils", "Diseases": "rigid paralysis, often with lockjaw\nstarts with cramping and twitching around wound site then spreads", "Pathogenesis factors": "toxin called tetanospasmin which blocks the release of inhibitory neurotransmitters such as GABA and glycine", "Treatment": "antitoxin sera with penicillin or metronidazole", "Prevention": "DPT vaccine"}}, {"name": "Influenza", "category": "Viruses", "attributes": {"Characteristics": "Types A, B, C\nSegmented, ssRNA, negative sense, enveloped", "Transmission": "Respiratory droplets\nVery contagious in winter", "Diseases": "Acute fever onset, chills, headache, myalgia, athralgia, dry cough, sore throat", "Treatment": "Neuraminidase inhibitors: zanamivir, oseltamivir", "Prevention": "Whole virus vaccine"}}, {"name": "HIV I & II", "category": "Viruses", "attributes": {"Characteristics": "single stranded RNA, diploid, has reverse transcriptase, enveloped", "Transmission": "parenteral, blood-exposure, sexual contact (oral, anal, and vaginal), mother-child", "Diseases": "AIDS, acute infection causes flu-like symptoms", "Pathogenesis factors": "virus infects CD4 T cells and macrophages and dendritic cells. Pt is infected for life, CD4 cells slowly decline", "Identification": "4th gen test for p24 antigen and HIV antibodies. Confirm with PCR", "Treatment": "HAART beginning upon confirmation of infection"}}, {"name": "Plasmodium spp.", "category": "Parasites", "attributes": {"Characteristics": "protozoa", "Transmission": "bite of Anopheles mosquitos", "Diseases": "malaria\n\nmost common symptoms are fever, headache, weakness, and night sweats", "Pathogenesis factors": "starts in liver then goes to blood cells. Falciparum causes distortion of RBC shape", "Identification": "visualization of organisms in blood smear", "Treatment": "chloroquine, if resistant can get arteminisin"}}], "Anti-Infectives": [{"name": "Penicillin", "category": "Penicillins", "attributes": {"Mechanism of action": "binds transpeptides, prevent crosslinking and weaken cell wall", "Use": "narrow spectrum, gram positive (strep)", "Adverse Reactions": "allergies", "Mechanism of resistance": "mutations encoding transpeptidases (mec2), beta-lactamases"}}, {"name": "Vancomycin", "category": "Glycopeptides", "attributes": {"Mechanism of action": "Inhibits cell wall synthesis by binding D-ala D-ala portion of cell wall precursors", "Use": "gram positive only, reserved for resistant infections (MRSA)", "Adverse Reactions": "Red man syndrome (flushing due to histamine release), Ototoxicity, Nephrotoxicity", "Mechanism of resistance": "change in binding site to D-ala D-lac"}}, {"name": "Gentamicin", "category": "Aminoglycosides", "attributes": {"Mechanism of action": "binds 30S subunit to cause misreading of mRNA", "Use": "severe gram negative rod infections", "Adverse Reactions": "Nephrotoxicity, Ototoxicity (irreversible), Neuromuscular blockade", "Mechanism of resistance": "transferase enzymes that inactivate drug"}}, {"name": "Azithromycin", "category": "Macrolides", "attributes": {"Mechanism of action": "binds 23S rRNA of 50S subunit", "Use": "atypical pneumonias (Mycoplasma, Chlamydia, Legionella), STDs (Chlamydia)", "Adverse Reactions": "GI motility issues, arrhythmia (long QT), cholestatic hepatitis", "Mechanism of resistance": "methylation of 23S rRNA binding site"}}], "Anti-Neoplastics": [{"name": "Methotrexate", "category": "Antimetabolites", "attributes": {"Mechanism of Action": "Folic acid analog, inhibits dihydrofolate reductase", "Use": "ALL, non-Hodgkin's lymphomas, osteosarcomas, RA, psoriasis", "Toxicity": "myelosuppression, GI toxicity, Hepatotoxicity, pulmonary toxicity"}}, {"name": "5-Fluorouracil", "category": "Pyrimidine Analog", "attributes": {"Mechanism of Action": "Competitively inhibits thymidylate synthase leading to a decrease in DNA synthesis", "Use": "slow growing solid tumors (colorectal, breast, ovarian)", "Toxicity": "GI toxicity (severe ulceration), myelosuppression, alopecia"}}, {"name": "Doxorubicin", "category": "Anthracycline", "attributes": {"Mechanism of Action": "Intercalates DNA, inhibits topoisomerase II, generates free radicals", "Use": "Solid tumors, leukemias, lymphomas", "Toxicity": "Cardiotoxicity (dilated cardiomyopathy), myelosuppression, alopecia", "Mnemonic": "Ruby Red Heart (Cardiotoxicity)"}}, {"name": "Cyclophosphamide", "category": "Alkylating Agent", "attributes": {"Mechanism of Action": "Covalently crosslink DNA at guanine N-7", "Use": "Solid tumors, leukemia, lymphoma", "Toxicity": "Myelosuppression, Hemorrhagic cystitis (prevent with mesna)"}}, {"name": "Imatinib", "category": "Tyrosine Kinase Inhibitor", "attributes": {"Mechanism of Action": "Inhibits BCR-ABL tyrosine kinase", "Use": "CML, GI stromal tumors", "Toxicity": "Fluid retention"}}], "Other Drugs": [{"name": "Fexofenadine", "category": "Antihistamines (kept by accident - ignoring)", "attributes": {"Use": "hayfever, allergy"}}, {"name": "Sildenafil", "category": "PDE-5 Inhibitor", "attributes": {"Mechanism of action": "Inhibits PDE-5, increasing cGMP, prolonging smooth muscle relaxation", "Use": "Erectile dysfunction, pulmonary hypertension", "Side effects": "Headache, flushing, dyspepsia, cyanopsia (blue-tinted vision)"}}], "Anemias": [{"name": "Iron Deficiency Anemia", "category": "Microcytic", "attributes": {"Mechanism/Cause": "Chronic blood loss (GI, menstruation), poor diet", "Symptoms": "Fatigue, pica (craving ice/dirt), koilonychia (spoon nails)", "Lab Values": "Low Ferritin, High TIBC, Low Serum Iron, Microcytic Hypochromic RBCs"}}, {"name": "B12 Deficiency (Pernicious Anemia)", "category": "Macrocytic", "attributes": {"Mechanism/Cause": "Autoantibodies to intrinsic factor or parietal cells", "Symptoms": "Fatigue, glossitis, Neurologic symptoms (paresthesias, subacute combined degeneration)", "Lab Values": "High MCV, Hypersegmented neutrophils, Low B12, High Homocysteine, High Methylmalonic acid"}}, {"name": "Sickle Cell Anemia", "category": "Normocytic/Hemolytic", "attributes": {"Mechanism/Cause": "Point mutation in beta-globin chain (Glu -> Val)", "Symptoms": "Vaso-occlusive crises (pain), aplastic crisis (parvovirus B19), autosplenectomy", "Treatment": "Hydroxyurea (increases HbF), hydration, pain control"}}], "Clotting Disorders": [{"name": "Hemophilia A", "category": "Bleeding", "attributes": {"Mechanism/Cause": "Factor VIII deficiency (X-linked)", "Symptoms": "Hemarthroses (bleeding into joints), easy bruising", "Lab Values": "Prolonged PTT, Normal PT, Normal platelet count"}}, {"name": "Von Willebrand Disease", "category": "Bleeding", "attributes": {"Mechanism/Cause": "Deficiency or defect in vWF (AD)", "Symptoms": "Mucosal bleeding (nosebleeds, heavy periods), prolonged bleeding time", "Lab Values": "Prolonged bleeding time, Normal/Prolonged PTT", "Treatment": "Desmopressin"}}], "WBC Disorders": [{"name": "CML", "category": "Myeloproliferative", "attributes": {"Cause(s)/pathophysiology": "t(9;22) Philadelphia chromosome (BCR-ABL)", "Symptoms/signs": "Splenomegaly, fatigue", "Treatment": "Imatinib (Tyrosine kinase inhibitor)"}}, {"name": "ALL", "category": "Acute Leukemia", "attributes": {"Typical Population": "Children", "Symptoms/signs": "Bone pain, lymphadenopathy, hepatosplenomegaly", "Immunophenotype": "TdT positive, CD10 positive (CALLA)"}}, {"name": "AML", "category": "Acute Leukemia", "attributes": {"Typical Population": "Adults (median age 65)", "Morphological changes": "Auer rods (crystal aggregates of MPO)", "Prognosis": "Variable"}}]};

    // --- APP STATE ---
    let activeDeckName = Object.keys(db)[0];
    let activeItems = db[activeDeckName];
    let currentItem = null;
    let streak = 0;
    let isFlashcardMode = false;
    let flaggedItems = new Set(); // Stores names like "Microbes:Staphylococcus aureus"

    // --- INITIALIZATION ---
    function init() {
        // Load flags from localStorage
        const savedFlags = localStorage.getItem('med_mastermind_flags');
        if (savedFlags) {
            flaggedItems = new Set(JSON.parse(savedFlags));
        }

        renderNav();
        generateQuestion();
    }

    function renderNav() {
        const navContainer = document.getElementById('nav-container');
        navContainer.innerHTML = '';
        
        // Deck Buttons
        Object.keys(db).forEach(key => {
            const btn = document.createElement('button');
            btn.textContent = key;
            btn.className = 'nav-btn';
            if(key === activeDeckName && activeDeckName !== 'Flagged') btn.classList.add('active');
            btn.onclick = () => switchDeck(key);
            navContainer.appendChild(btn);
        });

        // Flagged Button
        const flagBtn = document.createElement('button');
        flagBtn.textContent = `Flagged (${flaggedItems.size})`;
        flagBtn.className = 'nav-btn flagged-deck';
        if(activeDeckName === 'Flagged') flagBtn.classList.add('active');
        flagBtn.onclick = () => switchDeck('Flagged');
        navContainer.appendChild(flagBtn);
    }

    function switchDeck(deckName) {
        if (deckName === 'Flagged') {
            if (flaggedItems.size === 0) {
                alert("No flagged items yet! Flag some questions first.");
                return;
            }
            // Construct a temporary deck from flagged items
            const flaggedDeck = [];
            flaggedItems.forEach(id => {
                const [dName, iName] = id.split(':');
                const item = db[dName].find(i => i.name === iName);
                if (item) flaggedDeck.push(item);
            });
            activeItems = flaggedDeck;
        } else {
            activeItems = db[deckName];
        }
        
        activeDeckName = deckName;
        streak = 0;
        document.getElementById('streak').textContent = "Streak: 0";
        document.getElementById('deck-title').textContent = "Deck: " + deckName;
        
        renderNav();
        generateQuestion();
    }

    function toggleMode() {
        isFlashcardMode = document.getElementById('mode-switch').checked;
        
        const quizUI = document.getElementById('quiz-interface');
        const flashUI = document.getElementById('flashcard-interface');
        
        if (isFlashcardMode) {
            quizUI.classList.add('hidden');
            flashUI.classList.remove('hidden');
        } else {
            quizUI.classList.remove('hidden');
            flashUI.classList.add('hidden');
        }
        generateQuestion();
    }

    function toggleFlag() {
        if (!currentItem) return;
        
        // Find original deck name for this item if we are in Flagged mode
        let originalDeck = activeDeckName;
        if (activeDeckName === 'Flagged') {
            // We have to reverse search or store it on the item. 
            // Simplified: iterate DB to find where it came from.
            for (const [key, val] of Object.entries(db)) {
                if (val.some(i => i.name === currentItem.name)) {
                    originalDeck = key;
                    break;
                }
            }
        }

        const id = `${originalDeck}:${currentItem.name}`;
        const btn = document.getElementById('flag-btn');
        
        if (flaggedItems.has(id)) {
            flaggedItems.delete(id);
            btn.classList.remove('active');
            btn.textContent = "⚑ Flag";
        } else {
            flaggedItems.add(id);
            btn.classList.add('active');
            btn.textContent = "★ Flagged";
        }
        
        localStorage.setItem('med_mastermind_flags', JSON.stringify([...flaggedItems]));
        renderNav(); // Update count
    }

    function generateQuestion() {
        document.getElementById('next-btn').classList.add('hidden');
        
        // Reset Flashcard UI
        document.getElementById('reveal-btn').classList.remove('hidden');
        document.getElementById('flashcard-answer').style.display = 'none';
        document.getElementById('flashcard-controls').classList.add('hidden');
        document.getElementById('options').innerHTML = ''; // Clear quiz opts

        // Pick Random Item
        currentItem = activeItems[Math.floor(Math.random() * activeItems.length)];
        
        // Check Flag Status
        // We need to find its ID
        let originalDeck = activeDeckName;
        if (activeDeckName === 'Flagged') {
             for (const [key, val] of Object.entries(db)) {
                if (val.some(i => i.name === currentItem.name)) {
                    originalDeck = key;
                    break;
                }
            }
        }
        const id = `${originalDeck}:${currentItem.name}`;
        const flagBtn = document.getElementById('flag-btn');
        if (flaggedItems.has(id)) {
            flagBtn.classList.add('active');
            flagBtn.textContent = "★ Flagged";
        } else {
            flagBtn.classList.remove('active');
            flagBtn.textContent = "⚑ Flag";
        }

        // Pick Attribute
        const keys = Object.keys(currentItem.attributes);
        if (keys.length === 0) { generateQuestion(); return; }
        const attrKey = keys[Math.floor(Math.random() * keys.length)];
        
        document.getElementById('category').textContent = currentItem.category || activeDeckName;
        document.getElementById('clue-label').textContent = attrKey;
        document.getElementById('question-text').textContent = currentItem.attributes[attrKey];

        // --- QUIZ MODE SETUP ---
        if (!isFlashcardMode) {
            const correctAns = currentItem.name;
            let options = new Set();
            options.add(correctAns);
            
            // Generate Distractors
            let attempts = 0;
            // Use the WHOLE DB for distractors if deck is small (like Flagged)
            const pool = activeItems.length < 4 ? Object.values(db).flat() : activeItems;
            
            while(options.size < 4 && attempts < 50) {
                const r = pool[Math.floor(Math.random() * pool.length)];
                options.add(r.name);
                attempts++;
            }
            
            const optionsArray = Array.from(options).sort(() => Math.random() - 0.5);
            const container = document.getElementById('options');
            
            optionsArray.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.textContent = opt;
                btn.onclick = () => checkQuizAnswer(btn, opt, correctAns);
                container.appendChild(btn);
            });
        }
    }

    // --- QUIZ LOGIC ---
    function checkQuizAnswer(btn, selected, correct) {
        const buttons = document.querySelectorAll('.opt-btn');
        buttons.forEach(b => b.disabled = true);
        
        if (selected === correct) {
            btn.classList.add('correct');
            streak++;
        } else {
            btn.classList.add('wrong');
            streak = 0;
            // Auto-flag on wrong answer? (Optional, maybe annoying if misclick)
            // Let's keep it manual for now.
            buttons.forEach(b => {
                if (b.textContent === correct) b.classList.add('correct');
            });
        }
        document.getElementById('streak').textContent = `Streak: ${streak}`;
        document.getElementById('next-btn').classList.remove('hidden');
    }

    // --- FLASHCARD LOGIC ---
    function revealFlashcard() {
        document.getElementById('reveal-btn').classList.add('hidden');
        const ansBox = document.getElementById('flashcard-answer');
        ansBox.textContent = currentItem.name;
        ansBox.style.display = 'block';
        document.getElementById('flashcard-controls').classList.remove('hidden');
    }

    function markFlashcard(known) {
        if (!known) {
            // Auto flag if they forgot it in flashcard mode
            if (!document.getElementById('flag-btn').classList.contains('active')) {
                toggleFlag();
            }
            streak = 0;
        } else {
            streak++;
        }
        document.getElementById('streak').textContent = `Streak: ${streak}`;
        generateQuestion();
    }

    // Start
    init();

</script>
</body>
</html>