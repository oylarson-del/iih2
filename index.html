<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Medical Mastermind</title>
    <style>
        :root { --bg: #1e1e2e; --surface: #313244; --surface-2: #45475a; --text: #cdd6f4; --primary: #89b4fa; --success: #a6e3a1; --danger: #f38ba8; --accent: #fab387; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 15px; box-sizing: border-box; }
        .container { background: var(--surface); padding: 1.5rem; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); max-width: 800px; width: 100%; text-align: center; position: relative; display: flex; flex-direction: column; gap: 15px; }
        
        /* Typography */
        h1 { margin: 0; color: var(--primary); font-size: 1.8rem; letter-spacing: -0.5px; }
        .stats-bar { display: flex; justify-content: space-between; font-size: 0.85rem; color: #a6adc8; font-weight: 500; padding: 0 5px; }
        
        /* Navigation */
        .nav-scroll-wrapper { overflow-x: auto; padding-bottom: 5px; margin: 0 -10px; -webkit-overflow-scrolling: touch; }
        .nav-bar { display: flex; gap: 8px; padding: 0 10px; min-width: min-content; }
        .nav-btn { white-space: nowrap; padding: 8px 16px; border: none; background: var(--surface-2); color: #bac2de; border-radius: 20px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.2s ease; }
        .nav-btn.active { background: var(--primary); color: var(--bg); box-shadow: 0 4px 12px rgba(137, 180, 250, 0.3); }
        .nav-btn.flagged-deck.active { background: var(--danger); color: var(--bg); box-shadow: 0 4px 12px rgba(243, 139, 168, 0.3); }
        
        /* Question Card */
        .question-card { background: #181825; padding: 25px; border-radius: 12px; border: 1px solid var(--surface-2); position: relative; min-height: 180px; display: flex; flex-direction: column; justify-content: center; }
        .flag-toggle { position: absolute; top: 12px; right: 12px; background: transparent; border: none; color: var(--surface-2); font-size: 1.5rem; cursor: pointer; transition: transform 0.2s; }
        .flag-toggle.active { color: var(--danger); }
        .flag-toggle:active { transform: scale(1.2); }
        
        .vignette-container { text-align: left; display: flex; flex-direction: column; gap: 12px; }
        .vignette-item { border-left: 3px solid var(--accent); padding-left: 12px; }
        .vignette-label { display: block; color: var(--accent); font-size: 0.75rem; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px; margin-bottom: 4px; }
        .vignette-text { font-size: 1.05rem; line-height: 1.5; color: #e6e9ef; }

        /* Controls */
        .controls { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 5px; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 12px; }
        .switch-label { display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 0.9rem; font-weight: 600; }
        .toggle-switch { position: relative; width: 44px; height: 24px; background: var(--surface-2); border-radius: 12px; transition: 0.3s; }
        .toggle-switch::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .toggle-switch { background: var(--primary); }
        input:checked + .toggle-switch::after { transform: translateX(20px); }
        
        /* Answer Grid */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }
        
        .opt-btn { background: var(--surface-2); border: none; padding: 16px; border-radius: 10px; color: white; font-size: 1rem; font-weight: 500; cursor: pointer; transition: transform 0.1s, background 0.2s; min-height: 60px; display: flex; align-items: center; justify-content: center; text-align: center; line-height: 1.3; }
        .opt-btn:active { transform: scale(0.98); }
        .opt-btn.correct { background: var(--success); color: var(--bg); box-shadow: 0 0 15px rgba(166, 227, 161, 0.4); border: 1px solid var(--success); }
        .opt-btn.wrong { background: var(--danger); color: var(--bg); opacity: 0.6; }

        /* Flashcard */
        .flashcard-area { display: flex; flex-direction: column; gap: 15px; }
        .reveal-btn { width: 100%; background: var(--accent); color: var(--bg); font-weight: 800; padding: 20px; border: none; border-radius: 12px; font-size: 1.1rem; cursor: pointer; letter-spacing: 0.5px; }
        .answer-reveal { background: var(--surface-2); padding: 20px; border-radius: 12px; border: 2px solid var(--success); color: var(--success); font-weight: bold; font-size: 1.3rem; text-align: center; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        /* Next Button */
        .next-btn { background: var(--primary); color: var(--bg); width: 100%; padding: 18px; border: none; border-radius: 12px; font-weight: 800; font-size: 1.1rem; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 15px rgba(137, 180, 250, 0.4); animation: slideUp 0.3s ease; }
        
        .hidden { display: none !important; }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <h1>Medical Mastermind</h1>
    
    <div class="stats-bar">
        <span id="deck-indicator">Deck: Microbes</span>
        <span id="streak-indicator">Streak: 0</span>
    </div>

    <div class="nav-scroll-wrapper">
        <div id="nav-container" class="nav-bar">
            </div>
    </div>

    <div class="controls">
        <label class="switch-label">
            <input type="checkbox" id="mode-switch" onchange="toggleMode()" style="display:none">
            <div class="toggle-switch"></div>
            <span id="mode-label">Mode: Quiz</span>
        </label>
    </div>

    <div class="question-card">
        <button id="flag-btn" class="flag-toggle" onclick="toggleFlag()" title="Flag for Review">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"/></svg>
        </button>
        <div id="vignette-box" class="vignette-container">
            </div>
    </div>

    <div id="quiz-area" class="options-grid"></div>
    
    <div id="flashcard-area" class="flashcard-area hidden">
        <button id="reveal-btn" class="reveal-btn" onclick="revealFlashcard()">REVEAL DIAGNOSIS</button>
        <div id="flashcard-answer" class="answer-reveal hidden"></div>
        <div id="flashcard-judgement" class="options-grid hidden">
            <button class="opt-btn wrong" onclick="rateFlashcard(false)">Forgot</button>
            <button class="opt-btn correct" onclick="rateFlashcard(true)">Remembered</button>
        </div>
    </div>

    <button id="next-btn" class="next-btn hidden" onclick="nextQuestion()">Next Case ➔</button>
</div>

<script>
    // --- DATABASE (Filtered for your needs) ---
    const db = {"Microbes": [{"name": "Staphylococcus aureus", "category": "Bacteria", "attributes": {"Characteristics": "Gram positive cocci", "Natural reservoir": "Transient normal flora on skin, vagina, other mucosal surfaces\n\nNasopharynx often colonized", "Transmission": "direct contact or respiratory droplets", "Diseases": "Skin infections: cellulitis, impetigo, folliculitis, carbuncles, scaled skin syndrome\n\nosteomyelitis, septic arthritis, endocarditis, pnemonia, gatroenteritis\n\ntoxic shock, bactermeia", "Risk factors": "implanted devices, IV drug use, intubation", "Pathogenesis factors": "adhesion proteins, MSCRAMMs, toxins", "Identification": "gram stain and culture\n\ncatalase+, coagulase+, beta hemolytic, yallow colonies on mannitol-salt agar", "Treatment": "I&D absesses\n\nMRSA: Vancomycin\n\nMSSA: nafcillin", "Prevention": "Good hygiene"}}, {"name": "Staphylococcus epidermidis", "category": "Bacteria", "attributes": {"Characteristics": "Gram positive cocci", "Natural reservoir": "Normal skin flora, mucosal surfaces, conjuctiva, ears, vagina", "Transmission": "normal flora by direct contact", "Diseases": "infections due to implanted devices", "Risk factors": "implanted devices", "Pathogenesis factors": "biofilms", "Identification": "gram stain and culture", "Treatment": "Vancomycin with rifampin or gentamicin", "Prevention": "Good hygiene"}}, {"name": "Strepococcus pyogenes (GAS)", "category": "Bacteria", "attributes": {"Characteristics": "Gram positive cocci", "Transmission": "respiratory droplets or direct contact", "Diseases": "cellulitis, impetigo, erysipelas\n\nscarlet fever, pueperal sepsis, bacteremia, pneumonia, necrotizing fasciitis, TSS, pharyngitis", "Identification": "gram stain and culture\n\ncatalase negative, beta hemolytic, bacitracin sensitive", "Treatment": "Penicillin"}}, {"name": "Streptococcus Agalactiae (GBS)", "category": "Bacteria", "attributes": {"Characteristics": "Gram positive cocci", "Transmission": "mother to newborn during pregnancy, delivery, or later", "Diseases": "meningitis, sepsis in neonates, skin infections esp. in diabetic foot ulcers", "Treatment": "penicillin, ampicillin with gentamycin for severe cases", "Prevention": "screening of pregnant women"}}, {"name": "Clostridium tetani", "category": "Bacteria", "attributes": {"Transmission": "innoculation via trauma with contaminated soils", "Diseases": "rigid paralysis, often with lockjaw\nstarts with cramping and twitching around wound site then spreads", "Pathogenesis factors": "toxin called tetanospasmin which blocks the release of inhibitory neurotransmitters such as GABA and glycine", "Treatment": "antitoxin sera with penicillin or metronidazole", "Prevention": "DPT vaccine"}}, {"name": "Influenza", "category": "Viruses", "attributes": {"Characteristics": "Types A, B, C\nSegmented, ssRNA, negative sense, enveloped", "Transmission": "Respiratory droplets\nVery contagious in winter", "Diseases": "Acute fever onset, chills, headache, myalgia, athralgia, dry cough, sore throat", "Treatment": "Neuraminidase inhibitors: zanamivir, oseltamivir", "Prevention": "Whole virus vaccine"}}, {"name": "HIV I & II", "category": "Viruses", "attributes": {"Characteristics": "single stranded RNA, diploid, has reverse transcriptase, enveloped", "Transmission": "parenteral, blood-exposure, sexual contact (oral, anal, and vaginal), mother-child", "Diseases": "AIDS, acute infection causes flu-like symptoms", "Pathogenesis factors": "virus infects CD4 T cells and macrophages and dendritic cells. Pt is infected for life, CD4 cells slowly decline", "Identification": "4th gen test for p24 antigen and HIV antibodies. Confirm with PCR", "Treatment": "HAART beginning upon confirmation of infection"}}, {"name": "Plasmodium spp.", "category": "Parasites", "attributes": {"Characteristics": "protozoa", "Transmission": "bite of Anopheles mosquitos", "Diseases": "malaria\n\nmost common symptoms are fever, headache, weakness, and night sweats", "Pathogenesis factors": "starts in liver then goes to blood cells. Falciparum causes distortion of RBC shape", "Identification": "visualization of organisms in blood smear", "Treatment": "chloroquine, if resistant can get arteminisin"}}], "Anti-Infectives": [{"name": "Penicillin", "category": "Penicillins", "attributes": {"Mechanism of action": "binds transpeptides, prevent crosslinking and weaken cell wall", "Use": "narrow spectrum, gram positive (strep)", "Adverse Reactions": "allergies", "Mechanism of resistance": "mutations encoding transpeptidases (mec2), beta-lactamases"}}, {"name": "Vancomycin", "category": "Glycopeptides", "attributes": {"Mechanism of action": "Inhibits cell wall synthesis by binding D-ala D-ala portion of cell wall precursors", "Use": "gram positive only, reserved for resistant infections (MRSA)", "Adverse Reactions": "Red man syndrome (flushing due to histamine release), Ototoxicity, Nephrotoxicity", "Mechanism of resistance": "change in binding site to D-ala D-lac"}}, {"name": "Gentamicin", "category": "Aminoglycosides", "attributes": {"Mechanism of action": "binds 30S subunit to cause misreading of mRNA", "Use": "severe gram negative rod infections", "Adverse Reactions": "Nephrotoxicity, Ototoxicity (irreversible), Neuromuscular blockade", "Mechanism of resistance": "transferase enzymes that inactivate drug"}}, {"name": "Azithromycin", "category": "Macrolides", "attributes": {"Mechanism of action": "binds 23S rRNA of 50S subunit", "Use": "atypical pneumonias (Mycoplasma, Chlamydia, Legionella), STDs (Chlamydia)", "Adverse Reactions": "GI motility issues, arrhythmia (long QT), cholestatic hepatitis", "Mechanism of resistance": "methylation of 23S rRNA binding site"}}], "Anti-Neoplastics": [{"name": "Methotrexate", "category": "Antimetabolites", "attributes": {"Mechanism of Action": "Folic acid analog, inhibits dihydrofolate reductase", "Use": "ALL, non-Hodgkin's lymphomas, osteosarcomas, RA, psoriasis", "Toxicity": "myelosuppression, GI toxicity, Hepatotoxicity, pulmonary toxicity"}}, {"name": "5-Fluorouracil", "category": "Pyrimidine Analog", "attributes": {"Mechanism of Action": "Competitively inhibits thymidylate synthase leading to a decrease in DNA synthesis", "Use": "slow growing solid tumors (colorectal, breast, ovarian)", "Toxicity": "GI toxicity (severe ulceration), myelosuppression, alopecia"}}, {"name": "Doxorubicin", "category": "Anthracycline", "attributes": {"Mechanism of Action": "Intercalates DNA, inhibits topoisomerase II, generates free radicals", "Use": "Solid tumors, leukemias, lymphomas", "Toxicity": "Cardiotoxicity (dilated cardiomyopathy), myelosuppression, alopecia", "Mnemonic": "Ruby Red Heart (Cardiotoxicity)"}}, {"name": "Cyclophosphamide", "category": "Alkylating Agent", "attributes": {"Mechanism of Action": "Covalently crosslink DNA at guanine N-7", "Use": "Solid tumors, leukemia, lymphoma", "Toxicity": "Myelosuppression, Hemorrhagic cystitis (prevent with mesna)"}}, {"name": "Imatinib", "category": "Tyrosine Kinase Inhibitor", "attributes": {"Mechanism of Action": "Inhibits BCR-ABL tyrosine kinase", "Use": "CML, GI stromal tumors", "Toxicity": "Fluid retention"}}], "Other Drugs": [{"name": "Sildenafil", "category": "PDE-5 Inhibitor", "attributes": {"Mechanism of action": "Inhibits PDE-5, increasing cGMP, prolonging smooth muscle relaxation", "Use": "Erectile dysfunction, pulmonary hypertension", "Side effects": "Headache, flushing, dyspepsia, cyanopsia (blue-tinted vision)"}}], "Anemias": [{"name": "Iron Deficiency Anemia", "category": "Microcytic", "attributes": {"Mechanism/Cause": "Chronic blood loss (GI, menstruation), poor diet", "Symptoms": "Fatigue, pica (craving ice/dirt), koilonychia (spoon nails)", "Lab Values": "Low Ferritin, High TIBC, Low Serum Iron, Microcytic Hypochromic RBCs"}}, {"name": "B12 Deficiency (Pernicious Anemia)", "category": "Macrocytic", "attributes": {"Mechanism/Cause": "Autoantibodies to intrinsic factor or parietal cells", "Symptoms": "Fatigue, glossitis, Neurologic symptoms (paresthesias, subacute combined degeneration)", "Lab Values": "High MCV, Hypersegmented neutrophils, Low B12, High Homocysteine, High Methylmalonic acid"}}, {"name": "Sickle Cell Anemia", "category": "Normocytic/Hemolytic", "attributes": {"Mechanism/Cause": "Point mutation in beta-globin chain (Glu -> Val)", "Symptoms": "Vaso-occlusive crises (pain), aplastic crisis (parvovirus B19), autosplenectomy", "Treatment": "Hydroxyurea (increases HbF), hydration, pain control"}}], "Clotting Disorders": [{"name": "Hemophilia A", "category": "Bleeding", "attributes": {"Mechanism/Cause": "Factor VIII deficiency (X-linked)", "Symptoms": "Hemarthroses (bleeding into joints), easy bruising", "Lab Values": "Prolonged PTT, Normal PT, Normal platelet count"}}, {"name": "Von Willebrand Disease", "category": "Bleeding", "attributes": {"Mechanism/Cause": "Deficiency or defect in vWF (AD)", "Symptoms": "Mucosal bleeding (nosebleeds, heavy periods), prolonged bleeding time", "Lab Values": "Prolonged bleeding time, Normal/Prolonged PTT", "Treatment": "Desmopressin"}}], "WBC Disorders": [{"name": "CML", "category": "Myeloproliferative", "attributes": {"Cause(s)/pathophysiology": "t(9;22) Philadelphia chromosome (BCR-ABL)", "Symptoms/signs": "Splenomegaly, fatigue", "Treatment": "Imatinib (Tyrosine kinase inhibitor)"}}, {"name": "ALL", "category": "Acute Leukemia", "attributes": {"Typical Population": "Children", "Symptoms/signs": "Bone pain, lymphadenopathy, hepatosplenomegaly", "Immunophenotype": "TdT positive, CD10 positive (CALLA)"}}, {"name": "AML", "category": "Acute Leukemia", "attributes": {"Typical Population": "Adults (median age 65)", "Morphological changes": "Auer rods (crystal aggregates of MPO)", "Prognosis": "Variable"}}]};

    // --- APP LOGIC ---
    let activeDeck = "Microbes";
    let activeItems = db["Microbes"];
    let currentItem = null;
    let streak = 0;
    let isFlashcard = false;
    let flaggedItems = new Set(); 

    function init() {
        const saved = localStorage.getItem('med_mastermind_flags_v4');
        if (saved) flaggedItems = new Set(JSON.parse(saved));
        renderNav();
        nextQuestion();
    }

    function renderNav() {
        const nav = document.getElementById('nav-container');
        nav.innerHTML = '';
        
        // Deck Buttons
        Object.keys(db).forEach(key => {
            const btn = document.createElement('button');
            btn.className = `nav-btn ${key === activeDeck ? 'active' : ''}`;
            btn.textContent = key;
            btn.onclick = () => switchDeck(key);
            nav.appendChild(btn);
        });

        // Flag Button
        const flagBtn = document.createElement('button');
        flagBtn.className = `nav-btn flagged-deck ${activeDeck === 'Flagged' ? 'active' : ''}`;
        flagBtn.textContent = `★ Flagged (${flaggedItems.size})`;
        flagBtn.onclick = () => switchDeck('Flagged');
        nav.appendChild(flagBtn);
    }

    function switchDeck(name) {
        if (name === 'Flagged') {
            if (flaggedItems.size === 0) return alert("Flag some items first!");
            const flaggedList = [];
            flaggedItems.forEach(id => {
                const [d, n] = id.split(':');
                if (db[d]) {
                    const found = db[d].find(i => i.name === n);
                    if (found) flaggedList.push(found);
                }
            });
            activeItems = flaggedList;
        } else {
            activeItems = db[name];
        }
        activeDeck = name;
        streak = 0;
        document.getElementById('deck-indicator').textContent = `Deck: ${name}`;
        document.getElementById('streak-indicator').textContent = `Streak: 0`;
        renderNav();
        nextQuestion();
    }

    function toggleMode() {
        isFlashcard = document.getElementById('mode-switch').checked;
        document.getElementById('mode-label').textContent = isFlashcard ? "Mode: Flashcard" : "Mode: Quiz";
        document.getElementById('quiz-area').classList.toggle('hidden', isFlashcard);
        document.getElementById('flashcard-area').classList.toggle('hidden', !isFlashcard);
        nextQuestion();
    }

    function toggleFlag() {
        if (!currentItem) return;
        // Determine original deck for ID stability
        let sourceDeck = activeDeck;
        if (activeDeck === 'Flagged') {
            for (const [key, val] of Object.entries(db)) {
                if (val.find(i => i.name === currentItem.name)) sourceDeck = key;
            }
        }
        const id = `${sourceDeck}:${currentItem.name}`;
        
        if (flaggedItems.has(id)) flaggedItems.delete(id);
        else flaggedItems.add(id);
        
        localStorage.setItem('med_mastermind_flags_v4', JSON.stringify([...flaggedItems]));
        updateFlagIcon();
        renderNav(); // Update count
    }

    function updateFlagIcon() {
        const btn = document.getElementById('flag-btn');
        let sourceDeck = activeDeck;
        if (activeDeck === 'Flagged') {
            for (const [key, val] of Object.entries(db)) {
                if (val.find(i => i.name === currentItem.name)) sourceDeck = key;
            }
        }
        const id = `${sourceDeck}:${currentItem.name}`;
        
        if (flaggedItems.has(id)) {
            btn.classList.add('active');
            btn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"/></svg>';
        } else {
            btn.classList.remove('active');
            btn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"/></svg>';
        }
    }

    function nextQuestion() {
        // Reset UI
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('flashcard-answer').classList.add('hidden');
        document.getElementById('flashcard-judgement').classList.add('hidden');
        document.getElementById('reveal-btn').classList.remove('hidden');
        document.getElementById('quiz-area').innerHTML = '';
        
        // Pick Item
        currentItem = activeItems[Math.floor(Math.random() * activeItems.length)];
        updateFlagIcon();

        // --- VIGNETTE GENERATION ---
        // Pick 2-3 attributes randomly to simulate a case
        const attrs = currentItem.attributes;
        const keys = Object.keys(attrs);
        // Shuffle keys
        for (let i = keys.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [keys[i], keys[j]] = [keys[j], keys[i]];
        }
        // Take top 2 (or 1 if only 1 exists)
        const selectedKeys = keys.slice(0, Math.min(3, keys.length));
        
        const vignetteContainer = document.getElementById('vignette-box');
        vignetteContainer.innerHTML = '';
        
        selectedKeys.forEach(key => {
            const div = document.createElement('div');
            div.className = 'vignette-item';
            div.innerHTML = `<span class="vignette-label">${key}</span><span class="vignette-text">${attrs[key]}</span>`;
            vignetteContainer.appendChild(div);
        });

        // --- QUIZ OPTIONS ---
        if (!isFlashcard) {
            const correct = currentItem.name;
            const pool = activeItems.length < 5 ? Object.values(db).flat() : activeItems;
            let options = new Set([correct]);
            while (options.size < 4) {
                options.add(pool[Math.floor(Math.random() * pool.length)].name);
            }
            
            Array.from(options).sort(() => Math.random() - 0.5).forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.textContent = opt;
                btn.onclick = () => checkQuiz(btn, opt, correct);
                document.getElementById('quiz-area').appendChild(btn);
            });
        }
    }

    function checkQuiz(btn, selected, correct) {
        const btns = document.querySelectorAll('.opt-btn');
        btns.forEach(b => b.disabled = true);
        
        if (selected === correct) {
            btn.classList.add('correct');
            streak++;
        } else {
            btn.classList.add('wrong');
            streak = 0;
            btns.forEach(b => { if(b.textContent === correct) b.classList.add('correct'); });
            // Auto-flag on wrong?
            // toggleFlag(); 
        }
        document.getElementById('streak-indicator').textContent = `Streak: ${streak}`;
        document.getElementById('next-btn').classList.remove('hidden');
    }

    function revealFlashcard() {
        document.getElementById('reveal-btn').classList.add('hidden');
        const ans = document.getElementById('flashcard-answer');
        ans.textContent = currentItem.name;
        ans.classList.remove('hidden');
        document.getElementById('flashcard-judgement').classList.remove('hidden');
    }

    function rateFlashcard(success) {
        if (success) streak++;
        else {
            streak = 0;
            // Ensure it's flagged if they missed it
            let sourceDeck = activeDeck; // simplified check
            if (activeDeck === 'Flagged') { /* logic already handles ID stability */ }
            // Check if already flagged, if not, flag it
            const btn = document.getElementById('flag-btn');
            if (!btn.classList.contains('active')) toggleFlag();
        }
        document.getElementById('streak-indicator').textContent = `Streak: ${streak}`;
        nextQuestion();
    }

    init();
</script>
</body>
</html>